<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘©æ–¯å¯†ç è®°å¿†åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .tab.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-content {
            display: none;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .morse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .morse-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: transform 0.3s, background 0.3s;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }
        
        .morse-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .character {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .morse-code {
            font-size: 1.2rem;
            letter-spacing: 3px;
            font-family: monospace;
        }
        
        .morse-visual {
            display: flex;
            justify-content: center;
            margin: 10px 0;
            height: 20px;
        }
        
        .dot, .dash {
            display: inline-block;
            background: white;
            margin: 0 2px;
            border-radius: 50%;
        }
        
        .dot {
            width: 10px;
            height: 10px;
        }
        
        .dash {
            width: 25px;
            height: 10px;
            border-radius: 5px;
        }
        
        .game-area, .word-test-area, .practice-area {
            text-align: center;
            padding: 20px;
        }
        
        .difficulty-selector, .test-mode-selector, .mode-selector {
            margin: 20px 0;
        }
        
        .difficulty-btn, .test-mode-btn, .mode-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 5px;
        }
        
        .difficulty-btn.active, .test-mode-btn.active, .mode-btn.active {
            background: rgba(52, 152, 219, 0.7);
        }
        
        .difficulty-btn:hover, .test-mode-btn:hover, .mode-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .word-length-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .word-length-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .word-length-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .word-length-display {
            font-size: 1.2rem;
            min-width: 40px;
            text-align: center;
        }
        
        .question, .morse-question {
            font-size: 2rem;
            margin: 20px 0;
            min-height: 60px;
        }
        
        .options {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }
        
        .option {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
        }
        
        .option:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .correct {
            background: rgba(46, 204, 113, 0.5) !important;
        }
        
        .incorrect {
            background: rgba(231, 76, 60, 0.5) !important;
        }
        
        .score {
            font-size: 1.5rem;
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: #3498db;
            width: 0%;
            transition: width 0.5s;
        }
        
        .controls, .test-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        #toggle-layout {
            background: #2ecc71;
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        #toggle-layout:hover {
            background: #27ae60;
            transform: scale(1.05);
        }
        
        .input-area {
            margin: 20px 0;
        }
        
        #morse-input, #text-input, .word-input {
            padding: 10px;
            font-size: 1.2rem;
            width: 300px;
            max-width: 100%;
            border-radius: 5px;
            border: none;
            text-align: center;
            font-family: monospace;
            letter-spacing: 3px;
        }
        
        .result, .test-result {
            margin-top: 20px;
            min-height: 30px;
            font-size: 1.2rem;
        }
        
        .achievements {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .achievement {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0.5;
            transition: opacity 0.3s;
        }
        
        .achievement.unlocked {
            opacity: 1;
            background: rgba(241, 196, 15, 0.3);
        }
        
        .achievement-icon {
            font-size: 1.5rem;
        }
        
        .flash {
            animation: flash 0.5s;
        }
        
        @keyframes flash {
            0%, 100% { background: transparent; }
            50% { background: rgba(46, 204, 113, 0.5); }
        }
        
        @media (max-width: 768px) {
            .morse-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .options {
                flex-direction: column;
                align-items: center;
            }
            
            .option {
                width: 80%;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ‘©æ–¯å¯†ç è®°å¿†åŠ©æ‰‹</h1>
            <p class="subtitle">é€šè¿‡äº’åŠ¨æ¸¸æˆè½»æ¾è®°å¿†æ‘©æ–¯å¯†ç </p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="learn">å­¦ä¹ æ¨¡å¼</div>
            <div class="tab" data-tab="game">è®°å¿†æ¸¸æˆ</div>
            <div class="tab" data-tab="word-test">å•è¯æµ‹è¯•</div>
            <div class="tab" data-tab="practice">ç»ƒä¹ æ¨¡å¼</div>
            <div class="tab" data-tab="achievements">æˆå°±</div>
        </div>
        
        <div id="learn" class="tab-content active">
            <h2>æ‘©æ–¯å¯†ç è¡¨</h2>
            <p>ç‚¹å‡»å¡ç‰‡å¬å–å£°éŸ³ï¼Œå¯è§†åŒ–å¸®åŠ©è®°å¿†</p>
            <button id="toggle-layout">åˆ‡æ¢æ’å¸ƒ</button>
            <div class="morse-grid" id="morse-grid">
                <!-- æ‘©æ–¯å¯†ç å¡ç‰‡å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
        </div>
        
        <div id="game" class="tab-content">
            <div class="game-area">
                <h2>è®°å¿†æŒ‘æˆ˜</h2>
                <p>é€‰æ‹©æ­£ç¡®çš„æ‘©æ–¯å¯†ç å¯¹åº”çš„å­—æ¯æˆ–æ•°å­—</p>
                <div class="difficulty-selector">
                    <p>é€‰æ‹©éš¾åº¦ï¼š</p>
                    <button class="difficulty-btn active" data-difficulty="3">ç®€å• (3ä¸ªå­—ç¬¦)</button>
                    <button class="difficulty-btn" data-difficulty="2">ä¸­ç­‰ (2ä¸ªå­—ç¬¦)</button>
                    <button class="difficulty-btn" data-difficulty="1">é«˜çº§ (1ä¸ªå­—ç¬¦)</button>
                </div>
                <div class="score">å¾—åˆ†: <span id="score">0</span> | è¿ç»­æ­£ç¡®: <span id="streak">0</span></div>
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="question" id="question"></div>
                <div class="options" id="options">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
                <div class="controls">
                    <button id="play-sound">æ’­æ”¾å£°éŸ³</button>
                    <button id="next-question">ä¸‹ä¸€é¢˜</button>
                </div>
            </div>
        </div>
        
        <div id="word-test" class="tab-content">
            <div class="word-test-area">
                <h2>å•è¯æµ‹è¯•</h2>
                <div class="test-mode-selector">
                    <p>é€‰æ‹©æµ‹è¯•æ¨¡å¼ï¼š</p>
                    <button class="test-mode-btn active" data-mode="read-write">è¯»å†™æ¨¡å¼</button>
                    <button class="test-mode-btn" data-mode="listening">å¬åŠ›æµ‹è¯•</button>
                </div>
                <div class="word-length-selector">
                    <p>å•è¯é•¿åº¦ï¼š</p>
                    <button class="word-length-btn" id="decrease-length">-</button>
                    <div class="word-length-display"><span id="word-length">3</span></div>
                    <button class="word-length-btn" id="increase-length">+</button>
                </div>
                <div class="test-area">
                    <div class="morse-question" id="morse-question"></div>
                    <input type="text" class="word-input" id="word-input" placeholder="è¾“å…¥å•è¯" autocomplete="off">
                    <div class="test-controls">
                        <button class="test-btn" id="check-answer">æ£€æŸ¥ç­”æ¡ˆ</button>
                        <button class="test-btn" id="play-word">æ’­æ”¾å•è¯</button>
                        <button class="test-btn" id="next-word">ä¸‹ä¸€å•è¯</button>
                    </div>
                    <div class="test-result" id="test-result"></div>
                </div>
            </div>
        </div>
        
        <div id="practice" class="tab-content">
            <div class="practice-area">
                <h2>è‡ªç”±ç»ƒä¹ </h2>
                <div class="mode-selector">
                    <p>é€‰æ‹©æ¨¡å¼ï¼š</p>
                    <button class="mode-btn active" data-mode="morse-to-text">æ‘©æ–¯ç  â†’ æ–‡æœ¬</button>
                    <button class="mode-btn" data-mode="text-to-morse">æ–‡æœ¬ â†’ æ‘©æ–¯ç </button>
                </div>
                
                <div id="morse-to-text-area">
                    <p>åœ¨ä¸‹æ–¹è¾“å…¥æ‘©æ–¯å¯†ç ï¼ˆä½¿ç”¨.å’Œ-ï¼‰ï¼Œç”¨ç©ºæ ¼åˆ†éš”ä¸åŒå­—ç¬¦çš„ä»£ç ï¼Œçœ‹çœ‹å¯¹åº”çš„å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆ</p>
                    <p>ä¾‹å¦‚ï¼šè¾“å…¥ <code>... ---</code> ä¼šå¾—åˆ° "SO"</p>
                    <div class="input-area">
                        <input type="text" id="morse-input" placeholder="ä¾‹å¦‚: ... --- è¡¨ç¤ºSO" autocomplete="off">
                        <button id="translate-morse">ç¿»è¯‘</button>
                    </div>
                </div>
                
                <div id="text-to-morse-area" style="display: none;">
                    <p>åœ¨ä¸‹æ–¹è¾“å…¥æ–‡æœ¬ï¼Œçœ‹çœ‹å¯¹åº”çš„æ‘©æ–¯å¯†ç æ˜¯ä»€ä¹ˆ</p>
                    <p>ä¾‹å¦‚ï¼šè¾“å…¥ <code>SoSã€‚</code> ä¼šå¾—åˆ° ".../---/...ã€‚"</p>
                    <div class="input-area">
                        <input type="text" id="text-input" placeholder="ä¾‹å¦‚: SoSã€‚ è¡¨ç¤º.../---/..." autocomplete="off">
                        <button id="translate-text">ç¿»è¯‘</button>
                    </div>
                </div>
                
                <div class="result" id="practice-result"></div>
                <div class="controls">
                    <button id="clear-practice">æ¸…ç©º</button>
                    <button id="random-practice">éšæœºç¤ºä¾‹</button>
                </div>
            </div>
        </div>
        
        <div id="achievements" class="tab-content">
            <h2>æˆå°±ç³»ç»Ÿ</h2>
            <p>å®Œæˆå­¦ä¹ ç›®æ ‡è§£é”æˆå°±</p>
            <div class="achievements" id="achievements-list">
                <!-- æˆå°±å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // æ‘©æ–¯å¯†ç å­—å…¸
        const morseCode = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 
            'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..', 
            'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 
            'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 
            'Y': '-.--', 'Z': '--..', '0': '-----', '1': '.----', '2': '..---', 
            '3': '...--', '4': '....-', '5': '.....', '6': '-....', '7': '--...', 
            '8': '---..', '9': '----.', ' ': '/'
        };

        // åè½¬å­—å…¸ï¼Œç”¨äºä»æ‘©æ–¯å¯†ç æŸ¥æ‰¾å­—ç¬¦
        const reverseMorse = {};
        for (const [char, code] of Object.entries(morseCode)) {
            reverseMorse[code] = char;
        }

        // å¸¸ç”¨å•è¯åˆ—è¡¨ï¼ˆæŒ‰é•¿åº¦åˆ†ç»„ï¼‰
        const wordLists = {
            3: ['CAT', 'DOG', 'SUN', 'CAR', 'BED', 'EGG', 'ICE', 'KEY', 'LOW', 'MAP'],
            4: ['FISH', 'BOOK', 'MOON', 'STAR', 'TREE', 'FIRE', 'WIND', 'SNOW', 'RAIN', 'LAKE'],
            5: ['APPLE', 'HOUSE', 'WATER', 'EARTH', 'LIGHT', 'MUSIC', 'PLANT', 'STONE', 'CLOUD', 'GRASS'],
            6: ['FRIEND', 'FAMILY', 'SCHOOL', 'GARDEN', 'ANIMAL', 'FLOWER', 'PENCIL', 'WINDOW', 'POCKET', 'SILVER'],
            7: ['TEACHER', 'COUNTRY', 'WEATHER', 'HOLIDAY', 'PICTURE', 'MORNING', 'EVENING', 'LIBRARY', 'HISTORY', 'SCIENCE'],
            8: ['LANGUAGE', 'BUILDING', 'MOUNTAIN', 'HOSPITAL', 'UNIVERSITY', 'COMPUTER', 'TELEPHONE', 'BREAKFAST', 'BIRTHDAY', 'CHILDREN']
        };

        // æˆå°±ç³»ç»Ÿ
        const achievements = [
            { id: 'first_5', name: 'åˆå‡ºèŒ…åº', description: 'ç­”å¯¹5é“é¢˜', icon: 'â­', progress: 0, target: 5, unlocked: false },
            { id: 'streak_5', name: 'åŠ¿å¦‚ç ´ç«¹', description: 'è¿ç»­ç­”å¯¹5é“é¢˜', icon: 'ğŸ”¥', progress: 0, target: 5, unlocked: false },
            { id: 'score_20', name: 'å°æœ‰æˆå°±', description: 'æ€»åˆ†è¾¾åˆ°20åˆ†', icon: 'ğŸ†', progress: 0, target: 20, unlocked: false },
            { id: 'learn_all', name: 'å­¦å¯Œäº”è½¦', description: 'å­¦ä¹ æ‰€æœ‰å­—æ¯', icon: 'ğŸ“š', progress: 0, target: Object.keys(morseCode).length-1, unlocked: false },
            { id: 'practice_10', name: 'å‹¤å­¦è‹¦ç»ƒ', description: 'å®Œæˆ10æ¬¡ç»ƒä¹ ', icon: 'ğŸ’ª', progress: 0, target: 10, unlocked: false },
            { id: 'word_test_5', name: 'å•è¯è¾¾äºº', description: 'å®Œæˆ5æ¬¡å•è¯æµ‹è¯•', icon: 'ğŸ”¤', progress: 0, target: 5, unlocked: false }
        ];

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            score: 0,
            streak: 0,
            totalQuestions: 0,
            learnedChars: new Set(),
            practiceCount: 0,
            wordTestCount: 0,
            difficulty: 3, // é»˜è®¤ç®€å•éš¾åº¦ï¼ˆ3ä¸ªå­—ç¬¦ï¼‰
            wordLength: 3, // é»˜è®¤å•è¯é•¿åº¦
            testMode: 'read-write' // é»˜è®¤æµ‹è¯•æ¨¡å¼
        };

        // æ’åºçŠ¶æ€å˜é‡
        let currentSortMode = 'default';

        // å•è¯æµ‹è¯•çŠ¶æ€
        let wordTestState = {
            currentWord: '',
            currentMorse: ''
        };

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // ç”Ÿæˆæ‘©æ–¯å¯†ç å¡ç‰‡
            generateMorseCards();
            
            // ç”Ÿæˆæˆå°±åˆ—è¡¨
            generateAchievements();
            
            // è®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢
            setupTabs();
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame();
            
            // è®¾ç½®ç»ƒä¹ æ¨¡å¼
            setupPractice();
            
            // è®¾ç½®éš¾åº¦é€‰æ‹©
            setupDifficultySelector();
            
            // è®¾ç½®åˆ‡æ¢æ’å¸ƒæŒ‰é’®
            setupToggleLayout();
            
            // è®¾ç½®æ¨¡å¼é€‰æ‹©
            setupModeSelector();
            
            // è®¾ç½®å•è¯æµ‹è¯•
            setupWordTest();
            
            // åŠ è½½ä¿å­˜çš„æ¸¸æˆçŠ¶æ€
            loadGameState();
        });

        // è®¾ç½®åˆ‡æ¢æ’å¸ƒæŒ‰é’®
        function setupToggleLayout() {
            const toggleLayoutBtn = document.getElementById('toggle-layout');
            toggleLayoutBtn.addEventListener('click', function() {
                // åˆ‡æ¢æ’åºæ¨¡å¼
                currentSortMode = currentSortMode === 'default' ? 'complexity' : 'default';
                generateMorseCards();
            });
        }

        // è®¾ç½®æ¨¡å¼é€‰æ‹©
        function setupModeSelector() {
            const modeBtns = document.querySelectorAll('.mode-btn');
            const morseToTextArea = document.getElementById('morse-to-text-area');
            const textToMorseArea = document.getElementById('text-to-morse-area');
            
            modeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    modeBtns.forEach(b => b.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                    this.classList.add('active');
                    
                    const mode = this.getAttribute('data-mode');
                    
                    // æ˜¾ç¤ºå¯¹åº”çš„åŒºåŸŸ
                    if (mode === 'morse-to-text') {
                        morseToTextArea.style.display = 'block';
                        textToMorseArea.style.display = 'none';
                    } else {
                        morseToTextArea.style.display = 'none';
                        textToMorseArea.style.display = 'block';
                    }
                });
            });
        }

        // è®¾ç½®å•è¯æµ‹è¯•
        function setupWordTest() {
            // è®¾ç½®æµ‹è¯•æ¨¡å¼åˆ‡æ¢
            const testModeBtns = document.querySelectorAll('.test-mode-btn');
            testModeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    testModeBtns.forEach(b => b.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                    this.classList.add('active');
                    // æ›´æ–°æµ‹è¯•æ¨¡å¼
                    gameState.testMode = this.getAttribute('data-mode');
                    // ç”Ÿæˆæ–°å•è¯
                    generateWordTest();
                });
            });
            
            // è®¾ç½®å•è¯é•¿åº¦è°ƒæ•´
            const decreaseBtn = document.getElementById('decrease-length');
            const increaseBtn = document.getElementById('increase-length');
            const wordLengthDisplay = document.getElementById('word-length');
            
            decreaseBtn.addEventListener('click', function() {
                if (gameState.wordLength > 3) {
                    gameState.wordLength--;
                    wordLengthDisplay.textContent = gameState.wordLength;
                    generateWordTest();
                }
            });
            
            increaseBtn.addEventListener('click', function() {
                if (gameState.wordLength < 8) {
                    gameState.wordLength++;
                    wordLengthDisplay.textContent = gameState.wordLength;
                    generateWordTest();
                }
            });
            
            // è®¾ç½®æ£€æŸ¥ç­”æ¡ˆæŒ‰é’®
            const checkAnswerBtn = document.getElementById('check-answer');
            const wordInput = document.getElementById('word-input');
            const testResult = document.getElementById('test-result');
            
            checkAnswerBtn.addEventListener('click', function() {
                const userAnswer = wordInput.value.trim().toUpperCase();
                if (userAnswer === '') return;
                
                // å¢åŠ å•è¯æµ‹è¯•æ¬¡æ•°
                gameState.wordTestCount++;
                updateAchievementProgress('word_test_5', gameState.wordTestCount);
                saveGameState();
                
                if (userAnswer === wordTestState.currentWord) {
                    testResult.textContent = 'æ­£ç¡®ï¼';
                    testResult.className = 'test-result correct';
                } else {
                    testResult.textContent = `é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯: ${wordTestState.currentWord}`;
                    testResult.className = 'test-result incorrect';
                }
            });
            
            // è®¾ç½®æ’­æ”¾å•è¯æŒ‰é’®
            const playWordBtn = document.getElementById('play-word');
            playWordBtn.addEventListener('click', function() {
                playMorseCode(wordTestState.currentMorse);
            });
            
            // è®¾ç½®ä¸‹ä¸€å•è¯æŒ‰é’®
            const nextWordBtn = document.getElementById('next-word');
            nextWordBtn.addEventListener('click', generateWordTest);
            
            // æŒ‰å›è½¦é”®æ£€æŸ¥ç­”æ¡ˆ
            wordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAnswerBtn.click();
                }
            });
            
            // åˆå§‹ç”Ÿæˆä¸€ä¸ªå•è¯æµ‹è¯•
            generateWordTest();
        }

        // ç”Ÿæˆå•è¯æµ‹è¯•
        function generateWordTest() {
            const morseQuestion = document.getElementById('morse-question');
            const wordInput = document.getElementById('word-input');
            const testResult = document.getElementById('test-result');
            
            // æ¸…ç©ºè¾“å…¥å’Œç»“æœ
            wordInput.value = '';
            testResult.textContent = '';
            testResult.className = 'test-result';
            
            // è·å–å¯¹åº”é•¿åº¦çš„å•è¯åˆ—è¡¨
            const wordList = wordLists[gameState.wordLength] || wordLists[3];
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªå•è¯
            const randomWord = wordList[Math.floor(Math.random() * wordList.length)];
            wordTestState.currentWord = randomWord;
            
            // ç”Ÿæˆå•è¯çš„æ‘©æ–¯å¯†ç 
            let morse = '';
            for (let i = 0; i < randomWord.length; i++) {
                const char = randomWord[i];
                morse += (i > 0 ? ' ' : '') + morseCode[char];
            }
            wordTestState.currentMorse = morse;
            
            // æ ¹æ®æµ‹è¯•æ¨¡å¼æ˜¾ç¤ºé—®é¢˜
            if (gameState.testMode === 'read-write') {
                // è¯»å†™æ¨¡å¼ï¼šæ˜¾ç¤ºæ‘©æ–¯å¯†ç 
                morseQuestion.textContent = morse;
            } else {
                // å¬åŠ›æµ‹è¯•ï¼šä¸æ˜¾ç¤ºæ‘©æ–¯å¯†ç 
                morseQuestion.textContent = 'ç‚¹å‡»"æ’­æ”¾å•è¯"å¬å–æ‘©æ–¯å¯†ç ';
            }
        }

        // ç”Ÿæˆæ‘©æ–¯å¯†ç å¡ç‰‡
        function generateMorseCards() {
            const grid = document.getElementById('morse-grid');
            grid.innerHTML = ''; // æ¸…ç©ºç°æœ‰å¡ç‰‡
            
            // è·å–å­—ç¬¦æ•°ç»„å¹¶æ ¹æ®å½“å‰æ’åºæ¨¡å¼æ’åº
            let chars = Object.keys(morseCode).filter(c => c !== ' ');
            
            if (currentSortMode === 'complexity') {
                // æŒ‰ç‚¹å’Œçº¿æ•°é‡æ’åº
                chars.sort((a, b) => {
                    const codeA = morseCode[a];
                    const codeB = morseCode[b];
                    
                    // è®¡ç®—ç‚¹å’Œçº¿çš„æ•°é‡
                    const dotsA = (codeA.match(/\./g) || []).length;
                    const dashesA = (codeA.match(/-/g) || []).length;
                    const totalA = dotsA + dashesA;
                    
                    const dotsB = (codeB.match(/\./g) || []).length;
                    const dashesB = (codeB.match(/-/g) || []).length;
                    const totalB = dotsB + dashesB;
                    
                    // å…ˆæŒ‰æ€»æ•°é‡æ’åº
                    if (totalA !== totalB) {
                        return totalA - totalB;
                    }
                    
                    // æ€»æ•°é‡ç›¸åŒåˆ™æŒ‰ç‚¹çš„æ•°é‡æ’åº
                    return dotsA - dotsB;
                });
            }
            
            for (const char of chars) {
                const code = morseCode[char];
                
                const card = document.createElement('div');
                card.className = 'morse-card';
                card.innerHTML = `
                    <div class="character">${char}</div>
                    <div class="morse-visual" id="visual-${char}"></div>
                    <div class="morse-code">${code}</div>
                `;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶æ’­æ”¾å£°éŸ³
                card.addEventListener('click', function() {
                    playMorseCode(code);
                    // æ ‡è®°ä¸ºå·²å­¦ä¹ 
                    gameState.learnedChars.add(char);
                    updateAchievementProgress('learn_all', gameState.learnedChars.size);
                    saveGameState();
                    
                    // æ·»åŠ é—ªå…‰æ•ˆæœ
                    card.classList.add('flash');
                    setTimeout(() => card.classList.remove('flash'), 500);
                });
                
                grid.appendChild(card);
                
                // ç”Ÿæˆå¯è§†åŒ–æ‘©æ–¯å¯†ç 
                generateMorseVisual(code, char);
            }
        }

        // ç”Ÿæˆå¯è§†åŒ–æ‘©æ–¯å¯†ç ï¼ˆç‚¹å’Œåˆ’çº¿ï¼‰
        function generateMorseVisual(code, char) {
            const visual = document.getElementById(`visual-${char}`);
            for (const symbol of code) {
                const element = document.createElement('span');
                element.className = symbol === '.' ? 'dot' : 'dash';
                visual.appendChild(element);
            }
        }

        // è®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰æ ‡ç­¾
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // å¦‚æœæ˜¯æ¸¸æˆæ ‡ç­¾ï¼Œç¡®ä¿æ¸¸æˆå·²åˆå§‹åŒ–
                    if (tabId === 'game') {
                        initGame();
                    }
                    
                    // å¦‚æœæ˜¯å•è¯æµ‹è¯•æ ‡ç­¾ï¼Œç¡®ä¿å•è¯æµ‹è¯•å·²åˆå§‹åŒ–
                    if (tabId === 'word-test') {
                        generateWordTest();
                    }
                });
            });
        }

        // è®¾ç½®éš¾åº¦é€‰æ‹©
        function setupDifficultySelector() {
            const difficultyBtns = document.querySelectorAll('.difficulty-btn');
            
            difficultyBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    difficultyBtns.forEach(b => b.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                    this.classList.add('active');
                    // æ›´æ–°éš¾åº¦
                    gameState.difficulty = parseInt(this.getAttribute('data-difficulty'));
                    // é‡æ–°ç”Ÿæˆé—®é¢˜
                    if (document.getElementById('game').classList.contains('active')) {
                        initGame();
                    }
                });
            });
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            const playSoundBtn = document.getElementById('play-sound');
            const nextQuestionBtn = document.getElementById('next-question');
            const questionEl = document.getElementById('question');
            const optionsEl = document.getElementById('options');
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.score = 0;
            gameState.streak = 0;
            updateScoreDisplay();
            
            let currentQuestion = null;
            
            // ç”Ÿæˆæ–°é—®é¢˜
            function generateQuestion() {
                // éšæœºé€‰æ‹©æ˜¯å­—ç¬¦åˆ°æ‘©æ–¯å¯†ç è¿˜æ˜¯æ‘©æ–¯å¯†ç åˆ°å­—ç¬¦
                const isCharToMorse = Math.random() > 0.5;
                
                // æ ¹æ®éš¾åº¦ç”Ÿæˆå­—ç¬¦ä¸²
                const chars = Object.keys(morseCode).filter(c => c !== ' '); // æ’é™¤ç©ºæ ¼
                let correctString = '';
                let correctCode = '';
                
                // ç”ŸæˆæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²
                for (let i = 0; i < gameState.difficulty; i++) {
                    const randomChar = chars[Math.floor(Math.random() * chars.length)];
                    correctString += randomChar;
                    correctCode += (i > 0 ? ' ' : '') + morseCode[randomChar];
                }
                
                currentQuestion = {
                    type: isCharToMorse ? 'charToMorse' : 'morseToChar',
                    correctString,
                    correctCode
                };
                
                // æ˜¾ç¤ºé—®é¢˜
                if (isCharToMorse) {
                    questionEl.textContent = `"${correctString}" çš„æ‘©æ–¯å¯†ç æ˜¯ï¼Ÿ`;
                } else {
                    questionEl.textContent = `"${correctCode}" å¯¹åº”çš„å­—ç¬¦ä¸²æ˜¯ï¼Ÿ`;
                }
                
                // ç”Ÿæˆé€‰é¡¹
                generateOptions(correctString, correctCode, isCharToMorse);
                
                // æ›´æ–°è¿›åº¦æ¡
                updateProgressBar();
            }
            
            // ç”Ÿæˆé€‰é¡¹
            function generateOptions(correctString, correctCode, isCharToMorse) {
                optionsEl.innerHTML = '';
                
                // åˆ›å»ºé€‰é¡¹æ•°ç»„ï¼ˆåŒ…å«æ­£ç¡®ç­”æ¡ˆï¼‰
                let options = [];
                if (isCharToMorse) {
                    options.push(correctCode);
                    
                    // æ·»åŠ é”™è¯¯é€‰é¡¹
                    while (options.length < 4) {
                        // ç”Ÿæˆä¸€ä¸ªé”™è¯¯ç­”æ¡ˆ
                        let wrongCode = '';
                        const chars = Object.keys(morseCode).filter(c => c !== ' ');
                        
                        for (let i = 0; i < gameState.difficulty; i++) {
                            const randomChar = chars[Math.floor(Math.random() * chars.length)];
                            wrongCode += (i > 0 ? ' ' : '') + morseCode[randomChar];
                        }
                        
                        if (!options.includes(wrongCode)) {
                            options.push(wrongCode);
                        }
                        
                        // é˜²æ­¢æ— é™å¾ªç¯
                        if (options.length >= 4) break;
                    }
                } else {
                    options.push(correctString);
                    
                    // æ·»åŠ é”™è¯¯é€‰é¡¹
                    while (options.length < 4) {
                        // ç”Ÿæˆä¸€ä¸ªé”™è¯¯ç­”æ¡ˆ
                        let wrongString = '';
                        const chars = Object.keys(morseCode).filter(c => c !== ' ');
                        
                        for (let i = 0; i < gameState.difficulty; i++) {
                            const randomChar = chars[Math.floor(Math.random() * chars.length)];
                            wrongString += randomChar;
                        }
                        
                        if (!options.includes(wrongString)) {
                            options.push(wrongString);
                        }
                        
                        // é˜²æ­¢æ— é™å¾ªç¯
                        if (options.length >= 4) break;
                    }
                }
                
                // æ‰“ä¹±é€‰é¡¹é¡ºåº
                options = shuffleArray(options);
                
                // åˆ›å»ºé€‰é¡¹å…ƒç´ 
                options.forEach(option => {
                    const optionEl = document.createElement('div');
                    optionEl.className = 'option';
                    optionEl.textContent = option;
                    
                    optionEl.addEventListener('click', function() {
                        // æ£€æŸ¥ç­”æ¡ˆ
                        const isCorrect = isCharToMorse ? 
                            (option === correctCode) : (option === correctString);
                        
                        if (isCorrect) {
                            optionEl.classList.add('correct');
                            gameState.score += 10;
                            gameState.streak++;
                            gameState.totalQuestions++;
                            
                            // æ›´æ–°æˆå°±è¿›åº¦
                            updateAchievementProgress('first_5', gameState.totalQuestions);
                            updateAchievementProgress('score_20', gameState.score/10);
                            updateAchievementProgress('streak_5', gameState.streak);
                            
                            // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
                            playCorrectSound();
                        } else {
                            optionEl.classList.add('incorrect');
                            gameState.streak = 0;
                            
                            // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                            const correctOption = isCharToMorse ? correctCode : correctString;
                            document.querySelectorAll('.option').forEach(opt => {
                                if (opt.textContent === correctOption) {
                                    opt.classList.add('correct');
                                }
                            });
                            
                            // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                            playIncorrectSound();
                        }
                        
                        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
                        updateScoreDisplay();
                        
                        // ç¦ç”¨æ‰€æœ‰é€‰é¡¹
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.style.pointerEvents = 'none';
                        });
                        
                        // ä¿å­˜æ¸¸æˆçŠ¶æ€
                        saveGameState();
                    });
                    
                    optionsEl.appendChild(optionEl);
                });
            }
            
            // æ’­æ”¾å£°éŸ³æŒ‰é’®äº‹ä»¶
            playSoundBtn.addEventListener('click', function() {
                if (currentQuestion) {
                    playMorseCode(currentQuestion.correctCode);
                }
            });
            
            // ä¸‹ä¸€é¢˜æŒ‰é’®äº‹ä»¶
            nextQuestionBtn.addEventListener('click', generateQuestion);
            
            // åˆå§‹ç”Ÿæˆä¸€ä¸ªé—®é¢˜
            generateQuestion();
        }

        // è®¾ç½®ç»ƒä¹ æ¨¡å¼
        function setupPractice() {
            const translateMorseBtn = document.getElementById('translate-morse');
            const translateTextBtn = document.getElementById('translate-text');
            const clearBtn = document.getElementById('clear-practice');
            const randomBtn = document.getElementById('random-practice');
            const morseInput = document.getElementById('morse-input');
            const textInput = document.getElementById('text-input');
            const result = document.getElementById('practice-result');
            
            // æ‘©æ–¯ç è½¬æ–‡æœ¬æŒ‰é’®äº‹ä»¶
            translateMorseBtn.addEventListener('click', function() {
                const morse = morseInput.value.trim();
                if (morse) {
                    // å¢åŠ ç»ƒä¹ æ¬¡æ•°
                    gameState.practiceCount++;
                    updateAchievementProgress('practice_10', gameState.practiceCount);
                    saveGameState();
                    
                    // ç¿»è¯‘æ‘©æ–¯å¯†ç 
                    const translation = translateMorseString(morse);
                    if (translation) {
                        result.textContent = `"${morse}" å¯¹åº”çš„å­—ç¬¦ä¸²æ˜¯: ${translation}`;
                        result.style.color = '#2ecc71';
                        playMorseCode(morse);
                    } else {
                        result.textContent = `"${morse}" åŒ…å«æ— æ•ˆçš„æ‘©æ–¯å¯†ç `;
                        result.style.color = '#e74c3c';
                    }
                }
            });
            
            // æ–‡æœ¬è½¬æ‘©æ–¯ç æŒ‰é’®äº‹ä»¶
            translateTextBtn.addEventListener('click', function() {
                const text = textInput.value.trim();
                if (text) {
                    // å¢åŠ ç»ƒä¹ æ¬¡æ•°
                    gameState.practiceCount++;
                    updateAchievementProgress('practice_10', gameState.practiceCount);
                    saveGameState();
                    
                    // ç¿»è¯‘æ–‡æœ¬
                    const translation = translateTextToMorse(text);
                    result.textContent = `"${text}" å¯¹åº”çš„æ‘©æ–¯å¯†ç æ˜¯: ${translation}`;
                    result.style.color = '#2ecc71';
                }
            });
            
            // æ¸…ç©ºæŒ‰é’®äº‹ä»¶
            clearBtn.addEventListener('click', function() {
                morseInput.value = '';
                textInput.value = '';
                result.textContent = '';
            });
            
            // éšæœºç¤ºä¾‹æŒ‰é’®äº‹ä»¶
            randomBtn.addEventListener('click', function() {
                const modeBtns = document.querySelectorAll('.mode-btn');
                const activeMode = Array.from(modeBtns).find(btn => btn.classList.contains('active')).getAttribute('data-mode');
                
                if (activeMode === 'morse-to-text') {
                    const chars = Object.keys(morseCode).filter(c => c !== ' ');
                    const length = Math.floor(Math.random() * 5) + 1; // 1-5ä¸ªå­—ç¬¦
                    let morse = '';
                    
                    for (let i = 0; i < length; i++) {
                        const randomChar = chars[Math.floor(Math.random() * chars.length)];
                        morse += (i > 0 ? ' ' : '') + morseCode[randomChar];
                    }
                    
                    morseInput.value = morse;
                    
                    // è‡ªåŠ¨ç¿»è¯‘
                    translateMorseBtn.click();
                } else {
                    const chars = Object.keys(morseCode).filter(c => c !== ' ');
                    const length = Math.floor(Math.random() * 5) + 1; // 1-5ä¸ªå­—ç¬¦
                    let text = '';
                    
                    for (let i = 0; i < length; i++) {
                        const randomChar = chars[Math.floor(Math.random() * chars.length)];
                        text += randomChar;
                    }
                    
                    textInput.value = text;
                    
                    // è‡ªåŠ¨ç¿»è¯‘
                    translateTextBtn.click();
                }
            });
            
            // æŒ‰å›è½¦é”®ç¿»è¯‘
            morseInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    translateMorseBtn.click();
                }
            });
            
            textInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    translateTextBtn.click();
                }
            });
        }

        // ç¿»è¯‘æ‘©æ–¯å¯†ç å­—ç¬¦ä¸²ï¼ˆå¤„ç†ä¸è§„èŒƒè¾“å…¥ï¼‰
        function translateMorseString(morseString) {
            // å°†éç‚¹å’Œæ¨ªçš„å­—ç¬¦æ›¿æ¢ä¸ºç©ºæ ¼ï¼Œå¹¶å°†è¿ç»­çš„åˆ†éš”ç¬¦åˆå¹¶ä¸ºä¸€ä¸ªç©ºæ ¼
            const normalizedMorse = morseString
                .replace(/[^\.\-]/g, ' ')  // å°†éç‚¹å’Œæ¨ªçš„å­—ç¬¦æ›¿æ¢ä¸ºç©ºæ ¼
                .replace(/\s+/g, ' ')       // å°†è¿ç»­çš„ç©ºæ ¼åˆå¹¶ä¸ºä¸€ä¸ª
                .trim();                    // å»é™¤é¦–å°¾ç©ºæ ¼
            
            const codes = normalizedMorse.split(' ');
            let result = '';
            
            for (const code of codes) {
                if (reverseMorse[code]) {
                    result += reverseMorse[code];
                } else if (code === '') {
                    // å¿½ç•¥ç©ºå­—ç¬¦ä¸²ï¼ˆå¤šä¸ªè¿ç»­ç©ºæ ¼äº§ç”Ÿï¼‰
                    continue;
                } else {
                    return null; // æ— æ•ˆçš„æ‘©æ–¯å¯†ç 
                }
            }
            
            return result;
        }

        // ç¿»è¯‘æ–‡æœ¬ä¸ºæ‘©æ–¯å¯†ç 
        function translateTextToMorse(text) {
            let result = '';
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i].toUpperCase();
                
                if (morseCode[char]) {
                    result += (i > 0 ? '/' : '') + morseCode[char];
                } else {
                    // éå­—æ¯æ•°å­—å­—ç¬¦ç›´æ¥ä¿ç•™
                    result += char;
                }
            }
            
            return result;
        }

        // ç”Ÿæˆæˆå°±åˆ—è¡¨
        function generateAchievements() {
            const achievementsList = document.getElementById('achievements-list');
            achievementsList.innerHTML = '';
            
            achievements.forEach(achievement => {
                const achievementEl = document.createElement('div');
                achievementEl.className = `achievement ${achievement.unlocked ? 'unlocked' : ''}`;
                achievementEl.id = `achievement-${achievement.id}`;
                
                achievementEl.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div>
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-description">${achievement.description}</div>
                        <div class="achievement-progress">${achievement.progress}/${achievement.target}</div>
                    </div>
                `;
                
                achievementsList.appendChild(achievementEl);
            });
        }

        // æ›´æ–°æˆå°±è¿›åº¦
        function updateAchievementProgress(achievementId, progress) {
            const achievement = achievements.find(a => a.id === achievementId);
            if (achievement && !achievement.unlocked) {
                achievement.progress = Math.min(progress, achievement.target);
                
                // æ£€æŸ¥æ˜¯å¦è¾¾æˆæˆå°±
                if (achievement.progress >= achievement.target) {
                    achievement.unlocked = true;
                    showAchievementNotification(achievement);
                }
                
                // æ›´æ–°UI
                const achievementEl = document.getElementById(`achievement-${achievementId}`);
                if (achievementEl) {
                    achievementEl.querySelector('.achievement-progress').textContent = 
                        `${achievement.progress}/${achievement.target}`;
                    
                    if (achievement.unlocked) {
                        achievementEl.classList.add('unlocked');
                    }
                }
                
                saveGameState();
            }
        }

        // æ˜¾ç¤ºæˆå°±è§£é”é€šçŸ¥
        function showAchievementNotification(achievement) {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œå¯ä»¥æ˜¾ç¤ºä¸€ä¸ªä¸´æ—¶é€šçŸ¥
            console.log(`æˆå°±è§£é”: ${achievement.name} - ${achievement.description}`);
        }

        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScoreDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('streak').textContent = gameState.streak;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgressBar() {
            const progressBar = document.getElementById('progress');
            // ç®€å•æ¨¡æ‹Ÿè¿›åº¦ï¼Œå®é™…åº”ç”¨ä¸­å¯ä»¥æ ¹æ®å­¦ä¹ è¿›åº¦è°ƒæ•´
            const progress = Math.min(90, (gameState.totalQuestions % 10) * 10);
            progressBar.style.width = `${progress}%`;
        }

        // æ’­æ”¾æ‘©æ–¯å¯†ç å£°éŸ³
        function playMorseCode(code) {
            // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioCtx = new AudioContext();
            
            // åˆ›å»ºæŒ¯è¡å™¨
            const oscillator = audioCtx.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.value = 600; // é¢‘ç‡
            
            // åˆ›å»ºå¢ç›ŠèŠ‚ç‚¹ï¼ˆæ§åˆ¶éŸ³é‡ï¼‰
            const gainNode = audioCtx.createGain();
            gainNode.gain.value = 0;
            
            // è¿æ¥èŠ‚ç‚¹
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            // å¼€å§‹æŒ¯è¡
            oscillator.start();
            
            let time = audioCtx.currentTime;
            
            // æ’­æ”¾æ¯ä¸ªç¬¦å·
            for (const symbol of code) {
                if (symbol === '.') {
                    // ç‚¹ï¼šçŸ­éŸ³
                    gainNode.gain.setValueAtTime(0.5, time);
                    time += 0.1; // çŸ­éŸ³æŒç»­0.1ç§’
                    gainNode.gain.setValueAtTime(0, time);
                    time += 0.1; // ç¬¦å·é—´é—´éš”
                } else if (symbol === '-') {
                    // åˆ’çº¿ï¼šé•¿éŸ³
                    gainNode.gain.setValueAtTime(0.5, time);
                    time += 0.3; // é•¿éŸ³æŒç»­0.3ç§’
                    gainNode.gain.setValueAtTime(0, time);
                    time += 0.1; // ç¬¦å·é—´é—´éš”
                } else if (symbol === ' ') {
                    // å­—ç¬¦é—´é—´éš”
                    time += 0.2;
                }
            }
            
            // åœæ­¢æŒ¯è¡å™¨
            setTimeout(() => {
                oscillator.stop();
            }, (time - audioCtx.currentTime) * 1000);
        }

        // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
        function playCorrectSound() {
            // ç®€å•çš„æ­£ç¡®éŸ³æ•ˆ
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            oscillator.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1); // E5
            oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2); // G5
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        }

        // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
        function playIncorrectSound() {
            // ç®€å•çš„é”™è¯¯éŸ³æ•ˆ
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            oscillator.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(392, audioCtx.currentTime); // G4
            oscillator.frequency.setValueAtTime(311, audioCtx.currentTime + 0.2); // D#4
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.4);
        }

        // ä¿å­˜æ¸¸æˆçŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
        function saveGameState() {
            const stateToSave = {
                score: gameState.score,
                streak: gameState.streak,
                totalQuestions: gameState.totalQuestions,
                learnedChars: Array.from(gameState.learnedChars),
                practiceCount: gameState.practiceCount,
                wordTestCount: gameState.wordTestCount,
                difficulty: gameState.difficulty,
                wordLength: gameState.wordLength,
                testMode: gameState.testMode,
                achievements: achievements
            };
            localStorage.setItem('morseCodeTrainer', JSON.stringify(stateToSave));
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            const savedState = localStorage.getItem('morseCodeTrainer');
            if (savedState) {
                const state = JSON.parse(savedState);
                gameState.score = state.score || 0;
                gameState.streak = state.streak || 0;
                gameState.totalQuestions = state.totalQuestions || 0;
                gameState.learnedChars = new Set(state.learnedChars || []);
                gameState.practiceCount = state.practiceCount || 0;
                gameState.wordTestCount = state.wordTestCount || 0;
                gameState.difficulty = state.difficulty || 3;
                gameState.wordLength = state.wordLength || 3;
                gameState.testMode = state.testMode || 'read-write';
                
                // æ›´æ–°éš¾åº¦æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    if (parseInt(btn.getAttribute('data-difficulty')) === gameState.difficulty) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // æ›´æ–°å•è¯é•¿åº¦æ˜¾ç¤º
                document.getElementById('word-length').textContent = gameState.wordLength;
                
                // æ›´æ–°æµ‹è¯•æ¨¡å¼æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('.test-mode-btn').forEach(btn => {
                    if (btn.getAttribute('data-mode') === gameState.testMode) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                if (state.achievements) {
                    achievements.forEach((ach, index) => {
                        if (state.achievements[index]) {
                            ach.progress = state.achievements[index].progress || 0;
                            ach.unlocked = state.achievements[index].unlocked || false;
                        }
                    });
                }
                
                // é‡æ–°ç”Ÿæˆæˆå°±åˆ—è¡¨
                generateAchievements();
                updateScoreDisplay();
            }
        }

        // å·¥å…·å‡½æ•°ï¼šæ‰“ä¹±æ•°ç»„é¡ºåº
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
