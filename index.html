<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘©æ–¯å¯†ç è®°å¿†åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .tab.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-content {
            display: none;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .morse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .morse-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: transform 0.3s, background 0.3s;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }
        
        .morse-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .character {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .morse-code {
            font-size: 1.2rem;
            letter-spacing: 3px;
            font-family: monospace;
        }
        
        .morse-visual {
            display: flex;
            justify-content: center;
            margin: 10px 0;
            height: 20px;
        }
        
        .dot, .dash {
            display: inline-block;
            background: white;
            margin: 0 2px;
            border-radius: 50%;
        }
        
        .dot {
            width: 10px;
            height: 10px;
        }
        
        .dash {
            width: 25px;
            height: 10px;
            border-radius: 5px;
        }
        
        .game-area {
            text-align: center;
            padding: 20px;
        }
        
        .question {
            font-size: 3rem;
            margin: 20px 0;
            min-height: 80px;
        }
        
        .options {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }
        
        .option {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
        }
        
        .option:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .correct {
            background: rgba(46, 204, 113, 0.5) !important;
        }
        
        .incorrect {
            background: rgba(231, 76, 60, 0.5) !important;
        }
        
        .score {
            font-size: 1.5rem;
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: #3498db;
            width: 0%;
            transition: width 0.5s;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .sound-btn {
            position: relative;
        }
        
        .achievements {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .achievement {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0.5;
            transition: opacity 0.3s;
        }
        
        .achievement.unlocked {
            opacity: 1;
            background: rgba(241, 196, 15, 0.3);
        }
        
        .achievement-icon {
            font-size: 1.5rem;
        }
        
        .practice-area {
            text-align: center;
        }
        
        .input-area {
            margin: 20px 0;
        }
        
        #morse-input {
            padding: 10px;
            font-size: 1.2rem;
            width: 300px;
            max-width: 100%;
            border-radius: 5px;
            border: none;
            text-align: center;
            font-family: monospace;
            letter-spacing: 3px;
        }
        
        .result {
            margin-top: 20px;
            min-height: 30px;
            font-size: 1.2rem;
        }
        
        .flash {
            animation: flash 0.5s;
        }
        
        @keyframes flash {
            0%, 100% { background: transparent; }
            50% { background: rgba(46, 204, 113, 0.5); }
        }
        
        @media (max-width: 768px) {
            .morse-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .options {
                flex-direction: column;
                align-items: center;
            }
            
            .option {
                width: 80%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ‘©æ–¯å¯†ç è®°å¿†åŠ©æ‰‹</h1>
            <p class="subtitle">é€šè¿‡äº’åŠ¨æ¸¸æˆè½»æ¾è®°å¿†æ‘©æ–¯å¯†ç </p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="learn">å­¦ä¹ æ¨¡å¼</div>
            <div class="tab" data-tab="game">è®°å¿†æ¸¸æˆ</div>
            <div class="tab" data-tab="practice">ç»ƒä¹ æ¨¡å¼</div>
            <div class="tab" data-tab="achievements">æˆå°±</div>
        </div>
        
        <div id="learn" class="tab-content active">
            <h2>æ‘©æ–¯å¯†ç è¡¨</h2>
            <p>ç‚¹å‡»å¡ç‰‡å¬å–å£°éŸ³ï¼Œå¯è§†åŒ–å¸®åŠ©è®°å¿†</p>
            <div class="morse-grid" id="morse-grid">
                <!-- æ‘©æ–¯å¯†ç å¡ç‰‡å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
        </div>
        
        <div id="game" class="tab-content">
            <div class="game-area">
                <h2>è®°å¿†æŒ‘æˆ˜</h2>
                <p>é€‰æ‹©æ­£ç¡®çš„æ‘©æ–¯å¯†ç å¯¹åº”çš„å­—æ¯æˆ–æ•°å­—</p>
                <div class="score">å¾—åˆ†: <span id="score">0</span> | è¿ç»­æ­£ç¡®: <span id="streak">0</span></div>
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="question" id="question"></div>
                <div class="options" id="options">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
                <div class="controls">
                    <button id="play-sound">æ’­æ”¾å£°éŸ³</button>
                    <button id="next-question">ä¸‹ä¸€é¢˜</button>
                </div>
            </div>
        </div>
        
        <div id="practice" class="tab-content">
            <div class="practice-area">
                <h2>è‡ªç”±ç»ƒä¹ </h2>
                <p>åœ¨ä¸‹æ–¹è¾“å…¥æ‘©æ–¯å¯†ç ï¼ˆä½¿ç”¨.å’Œ-ï¼‰ï¼Œçœ‹çœ‹å¯¹åº”çš„å­—ç¬¦æ˜¯ä»€ä¹ˆ</p>
                <div class="input-area">
                    <input type="text" id="morse-input" placeholder="ä¾‹å¦‚: .- è¡¨ç¤ºA" autocomplete="off">
                    <button id="translate">ç¿»è¯‘</button>
                </div>
                <div class="result" id="practice-result"></div>
                <div class="controls">
                    <button id="clear-practice">æ¸…ç©º</button>
                    <button id="random-practice">éšæœºç¤ºä¾‹</button>
                </div>
            </div>
        </div>
        
        <div id="achievements" class="tab-content">
            <h2>æˆå°±ç³»ç»Ÿ</h2>
            <p>å®Œæˆå­¦ä¹ ç›®æ ‡è§£é”æˆå°±</p>
            <div class="achievements" id="achievements-list">
                <!-- æˆå°±å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // æ‘©æ–¯å¯†ç å­—å…¸
        const morseCode = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 
            'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..', 
            'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 
            'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 
            'Y': '-.--', 'Z': '--..', '0': '-----', '1': '.----', '2': '..---', 
            '3': '...--', '4': '....-', '5': '.....', '6': '-....', '7': '--...', 
            '8': '---..', '9': '----.', ' ': '/'
        };

        // åè½¬å­—å…¸ï¼Œç”¨äºä»æ‘©æ–¯å¯†ç æŸ¥æ‰¾å­—ç¬¦
        const reverseMorse = {};
        for (const [char, code] of Object.entries(morseCode)) {
            reverseMorse[code] = char;
        }

        // æˆå°±ç³»ç»Ÿ
        const achievements = [
            { id: 'first_5', name: 'åˆå‡ºèŒ…åº', description: 'ç­”å¯¹5é“é¢˜', icon: 'â­', progress: 0, target: 5, unlocked: false },
            { id: 'streak_5', name: 'åŠ¿å¦‚ç ´ç«¹', description: 'è¿ç»­ç­”å¯¹5é“é¢˜', icon: 'ğŸ”¥', progress: 0, target: 5, unlocked: false },
            { id: 'score_20', name: 'å°æœ‰æˆå°±', description: 'æ€»åˆ†è¾¾åˆ°20åˆ†', icon: 'ğŸ†', progress: 0, target: 20, unlocked: false },
            { id: 'learn_all', name: 'å­¦å¯Œäº”è½¦', description: 'å­¦ä¹ æ‰€æœ‰å­—æ¯', icon: 'ğŸ“š', progress: 0, target: Object.keys(morseCode).length-1, unlocked: false },
            { id: 'practice_10', name: 'å‹¤å­¦è‹¦ç»ƒ', description: 'å®Œæˆ10æ¬¡ç»ƒä¹ ', icon: 'ğŸ’ª', progress: 0, target: 10, unlocked: false }
        ];

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            score: 0,
            streak: 0,
            totalQuestions: 0,
            learnedChars: new Set(),
            practiceCount: 0
        };

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // ç”Ÿæˆæ‘©æ–¯å¯†ç å¡ç‰‡
            generateMorseCards();
            
            // ç”Ÿæˆæˆå°±åˆ—è¡¨
            generateAchievements();
            
            // è®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢
            setupTabs();
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame();
            
            // è®¾ç½®ç»ƒä¹ æ¨¡å¼
            setupPractice();
            
            // åŠ è½½ä¿å­˜çš„æ¸¸æˆçŠ¶æ€
            loadGameState();
        });

        // ç”Ÿæˆæ‘©æ–¯å¯†ç å¡ç‰‡
        function generateMorseCards() {
            const grid = document.getElementById('morse-grid');
            
            for (const [char, code] of Object.entries(morseCode)) {
                if (char === ' ') return; // è·³è¿‡ç©ºæ ¼
                
                const card = document.createElement('div');
                card.className = 'morse-card';
                card.innerHTML = `
                    <div class="character">${char}</div>
                    <div class="morse-visual" id="visual-${char}"></div>
                    <div class="morse-code">${code}</div>
                `;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶æ’­æ”¾å£°éŸ³
                card.addEventListener('click', function() {
                    playMorseCode(code);
                    // æ ‡è®°ä¸ºå·²å­¦ä¹ 
                    gameState.learnedChars.add(char);
                    updateAchievementProgress('learn_all', gameState.learnedChars.size);
                    saveGameState();
                    
                    // æ·»åŠ é—ªå…‰æ•ˆæœ
                    card.classList.add('flash');
                    setTimeout(() => card.classList.remove('flash'), 500);
                });
                
                grid.appendChild(card);
                
                // ç”Ÿæˆå¯è§†åŒ–æ‘©æ–¯å¯†ç 
                generateMorseVisual(code, char);
            }
        }

        // ç”Ÿæˆå¯è§†åŒ–æ‘©æ–¯å¯†ç ï¼ˆç‚¹å’Œåˆ’çº¿ï¼‰
        function generateMorseVisual(code, char) {
            const visual = document.getElementById(`visual-${char}`);
            for (const symbol of code) {
                const element = document.createElement('span');
                element.className = symbol === '.' ? 'dot' : 'dash';
                visual.appendChild(element);
            }
        }

        // è®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰æ ‡ç­¾
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // å¦‚æœæ˜¯æ¸¸æˆæ ‡ç­¾ï¼Œç¡®ä¿æ¸¸æˆå·²åˆå§‹åŒ–
                    if (tabId === 'game') {
                        initGame();
                    }
                });
            });
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            const playSoundBtn = document.getElementById('play-sound');
            const nextQuestionBtn = document.getElementById('next-question');
            const questionEl = document.getElementById('question');
            const optionsEl = document.getElementById('options');
            
            let currentQuestion = null;
            
            // ç”Ÿæˆæ–°é—®é¢˜
            function generateQuestion() {
                // éšæœºé€‰æ‹©æ˜¯å­—ç¬¦åˆ°æ‘©æ–¯å¯†ç è¿˜æ˜¯æ‘©æ–¯å¯†ç åˆ°å­—ç¬¦
                const isCharToMorse = Math.random() > 0.5;
                const chars = Object.keys(morseCode).filter(c => c !== ' '); // æ’é™¤ç©ºæ ¼
                const correctChar = chars[Math.floor(Math.random() * chars.length)];
                const correctCode = morseCode[correctChar];
                
                currentQuestion = {
                    type: isCharToMorse ? 'charToMorse' : 'morseToChar',
                    correctChar,
                    correctCode
                };
                
                // æ˜¾ç¤ºé—®é¢˜
                if (isCharToMorse) {
                    questionEl.textContent = `"${correctChar}" çš„æ‘©æ–¯å¯†ç æ˜¯ï¼Ÿ`;
                } else {
                    questionEl.textContent = `"${correctCode}" å¯¹åº”çš„å­—ç¬¦æ˜¯ï¼Ÿ`;
                }
                
                // ç”Ÿæˆé€‰é¡¹
                generateOptions(correctChar, correctCode, isCharToMorse);
                
                // æ›´æ–°è¿›åº¦æ¡
                updateProgressBar();
            }
            
            // ç”Ÿæˆé€‰é¡¹
            function generateOptions(correctChar, correctCode, isCharToMorse) {
                optionsEl.innerHTML = '';
                
                // åˆ›å»ºé€‰é¡¹æ•°ç»„ï¼ˆåŒ…å«æ­£ç¡®ç­”æ¡ˆï¼‰
                let options = [];
                if (isCharToMorse) {
                    options.push(correctCode);
                    
                    // æ·»åŠ é”™è¯¯é€‰é¡¹
                    const codes = Object.values(morseCode).filter(c => c !== correctCode && c !== '/');
                    while (options.length < 4 && codes.length > 0) {
                        const randomCode = codes[Math.floor(Math.random() * codes.length)];
                        if (!options.includes(randomCode)) {
                            options.push(randomCode);
                        }
                    }
                } else {
                    options.push(correctChar);
                    
                    // æ·»åŠ é”™è¯¯é€‰é¡¹
                    const chars = Object.keys(morseCode).filter(c => c !== correctChar && c !== ' ');
                    while (options.length < 4 && chars.length > 0) {
                        const randomChar = chars[Math.floor(Math.random() * chars.length)];
                        if (!options.includes(randomChar)) {
                            options.push(randomChar);
                        }
                    }
                }
                
                // æ‰“ä¹±é€‰é¡¹é¡ºåº
                options = shuffleArray(options);
                
                // åˆ›å»ºé€‰é¡¹å…ƒç´ 
                options.forEach(option => {
                    const optionEl = document.createElement('div');
                    optionEl.className = 'option';
                    optionEl.textContent = option;
                    
                    optionEl.addEventListener('click', function() {
                        // æ£€æŸ¥ç­”æ¡ˆ
                        const isCorrect = isCharToMorse ? 
                            (option === correctCode) : (option === correctChar);
                        
                        if (isCorrect) {
                            optionEl.classList.add('correct');
                            gameState.score += 10;
                            gameState.streak++;
                            gameState.totalQuestions++;
                            
                            // æ›´æ–°æˆå°±è¿›åº¦
                            updateAchievementProgress('first_5', gameState.totalQuestions);
                            updateAchievementProgress('score_20', gameState.score/10);
                            updateAchievementProgress('streak_5', gameState.streak);
                            
                            // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
                            playCorrectSound();
                        } else {
                            optionEl.classList.add('incorrect');
                            gameState.streak = 0;
                            
                            // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                            const correctOption = isCharToMorse ? correctCode : correctChar;
                            document.querySelectorAll('.option').forEach(opt => {
                                if (opt.textContent === correctOption) {
                                    opt.classList.add('correct');
                                }
                            });
                            
                            // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                            playIncorrectSound();
                        }
                        
                        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
                        updateScoreDisplay();
                        
                        // ç¦ç”¨æ‰€æœ‰é€‰é¡¹
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.style.pointerEvents = 'none';
                        });
                        
                        // ä¿å­˜æ¸¸æˆçŠ¶æ€
                        saveGameState();
                    });
                    
                    optionsEl.appendChild(optionEl);
                });
            }
            
            // æ’­æ”¾å£°éŸ³æŒ‰é’®äº‹ä»¶
            playSoundBtn.addEventListener('click', function() {
                if (currentQuestion) {
                    playMorseCode(currentQuestion.correctCode);
                }
            });
            
            // ä¸‹ä¸€é¢˜æŒ‰é’®äº‹ä»¶
            nextQuestionBtn.addEventListener('click', generateQuestion);
            
            // åˆå§‹ç”Ÿæˆä¸€ä¸ªé—®é¢˜
            generateQuestion();
        }

        // è®¾ç½®ç»ƒä¹ æ¨¡å¼
        function setupPractice() {
            const translateBtn = document.getElementById('translate');
            const clearBtn = document.getElementById('clear-practice');
            const randomBtn = document.getElementById('random-practice');
            const input = document.getElementById('morse-input');
            const result = document.getElementById('practice-result');
            
            // ç¿»è¯‘æŒ‰é’®äº‹ä»¶
            translateBtn.addEventListener('click', function() {
                const morse = input.value.trim();
                if (morse) {
                    // å¢åŠ ç»ƒä¹ æ¬¡æ•°
                    gameState.practiceCount++;
                    updateAchievementProgress('practice_10', gameState.practiceCount);
                    saveGameState();
                    
                    if (reverseMorse[morse]) {
                        result.textContent = `"${morse}" å¯¹åº”çš„å­—ç¬¦æ˜¯: ${reverseMorse[morse]}`;
                        result.style.color = '#2ecc71';
                        playMorseCode(morse);
                    } else {
                        result.textContent = `"${morse}" ä¸æ˜¯æœ‰æ•ˆçš„æ‘©æ–¯å¯†ç `;
                        result.style.color = '#e74c3c';
                    }
                }
            });
            
            // æ¸…ç©ºæŒ‰é’®äº‹ä»¶
            clearBtn.addEventListener('click', function() {
                input.value = '';
                result.textContent = '';
            });
            
            // éšæœºç¤ºä¾‹æŒ‰é’®äº‹ä»¶
            randomBtn.addEventListener('click', function() {
                const chars = Object.keys(morseCode).filter(c => c !== ' ');
                const randomChar = chars[Math.floor(Math.random() * chars.length)];
                const morse = morseCode[randomChar];
                input.value = morse;
                
                // è‡ªåŠ¨ç¿»è¯‘
                translateBtn.click();
            });
            
            // æŒ‰å›è½¦é”®ç¿»è¯‘
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    translateBtn.click();
                }
            });
        }

        // ç”Ÿæˆæˆå°±åˆ—è¡¨
        function generateAchievements() {
            const achievementsList = document.getElementById('achievements-list');
            
            achievements.forEach(achievement => {
                const achievementEl = document.createElement('div');
                achievementEl.className = `achievement ${achievement.unlocked ? 'unlocked' : ''}`;
                achievementEl.id = `achievement-${achievement.id}`;
                
                achievementEl.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div>
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-description">${achievement.description}</div>
                        <div class="achievement-progress">${achievement.progress}/${achievement.target}</div>
                    </div>
                `;
                
                achievementsList.appendChild(achievementEl);
            });
        }

        // æ›´æ–°æˆå°±è¿›åº¦
        function updateAchievementProgress(achievementId, progress) {
            const achievement = achievements.find(a => a.id === achievementId);
            if (achievement && !achievement.unlocked) {
                achievement.progress = Math.min(progress, achievement.target);
                
                // æ£€æŸ¥æ˜¯å¦è¾¾æˆæˆå°±
                if (achievement.progress >= achievement.target) {
                    achievement.unlocked = true;
                    showAchievementNotification(achievement);
                }
                
                // æ›´æ–°UI
                const achievementEl = document.getElementById(`achievement-${achievementId}`);
                if (achievementEl) {
                    achievementEl.querySelector('.achievement-progress').textContent = 
                        `${achievement.progress}/${achievement.target}`;
                    
                    if (achievement.unlocked) {
                        achievementEl.classList.add('unlocked');
                    }
                }
                
                saveGameState();
            }
        }

        // æ˜¾ç¤ºæˆå°±è§£é”é€šçŸ¥
        function showAchievementNotification(achievement) {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œå¯ä»¥æ˜¾ç¤ºä¸€ä¸ªä¸´æ—¶é€šçŸ¥
            console.log(`æˆå°±è§£é”: ${achievement.name} - ${achievement.description}`);
        }

        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScoreDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('streak').textContent = gameState.streak;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgressBar() {
            const progressBar = document.getElementById('progress');
            // ç®€å•æ¨¡æ‹Ÿè¿›åº¦ï¼Œå®é™…åº”ç”¨ä¸­å¯ä»¥æ ¹æ®å­¦ä¹ è¿›åº¦è°ƒæ•´
            const progress = Math.min(90, (gameState.totalQuestions % 10) * 10);
            progressBar.style.width = `${progress}%`;
        }

        // æ’­æ”¾æ‘©æ–¯å¯†ç å£°éŸ³
        function playMorseCode(code) {
            // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioCtx = new AudioContext();
            
            // åˆ›å»ºæŒ¯è¡å™¨
            const oscillator = audioCtx.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.value = 600; // é¢‘ç‡
            
            // åˆ›å»ºå¢ç›ŠèŠ‚ç‚¹ï¼ˆæ§åˆ¶éŸ³é‡ï¼‰
            const gainNode = audioCtx.createGain();
            gainNode.gain.value = 0;
            
            // è¿æ¥èŠ‚ç‚¹
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            // å¼€å§‹æŒ¯è¡
            oscillator.start();
            
            let time = audioCtx.currentTime;
            
            // æ’­æ”¾æ¯ä¸ªç¬¦å·
            for (const symbol of code) {
                if (symbol === '.') {
                    // ç‚¹ï¼šçŸ­éŸ³
                    gainNode.gain.setValueAtTime(0.5, time);
                    time += 0.1; // çŸ­éŸ³æŒç»­0.1ç§’
                    gainNode.gain.setValueAtTime(0, time);
                    time += 0.1; // ç¬¦å·é—´é—´éš”
                } else if (symbol === '-') {
                    // åˆ’çº¿ï¼šé•¿éŸ³
                    gainNode.gain.setValueAtTime(0.5, time);
                    time += 0.3; // é•¿éŸ³æŒç»­0.3ç§’
                    gainNode.gain.setValueAtTime(0, time);
                    time += 0.1; // ç¬¦å·é—´é—´éš”
                }
            }
            
            // åœæ­¢æŒ¯è¡å™¨
            setTimeout(() => {
                oscillator.stop();
            }, (time - audioCtx.currentTime) * 1000);
        }

        // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
        function playCorrectSound() {
            // ç®€å•çš„æ­£ç¡®éŸ³æ•ˆ
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            oscillator.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1); // E5
            oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2); // G5
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        }

        // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
        function playIncorrectSound() {
            // ç®€å•çš„é”™è¯¯éŸ³æ•ˆ
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            oscillator.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(392, audioCtx.currentTime); // G4
            oscillator.frequency.setValueAtTime(311, audioCtx.currentTime + 0.2); // D#4
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.4);
        }

        // ä¿å­˜æ¸¸æˆçŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
        function saveGameState() {
            const stateToSave = {
                score: gameState.score,
                streak: gameState.streak,
                totalQuestions: gameState.totalQuestions,
                learnedChars: Array.from(gameState.learnedChars),
                practiceCount: gameState.practiceCount,
                achievements: achievements
            };
            localStorage.setItem('morseCodeTrainer', JSON.stringify(stateToSave));
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            const savedState = localStorage.getItem('morseCodeTrainer');
            if (savedState) {
                const state = JSON.parse(savedState);
                gameState.score = state.score || 0;
                gameState.streak = state.streak || 0;
                gameState.totalQuestions = state.totalQuestions || 0;
                gameState.learnedChars = new Set(state.learnedChars || []);
                gameState.practiceCount = state.practiceCount || 0;
                
                if (state.achievements) {
                    achievements.forEach((ach, index) => {
                        if (state.achievements[index]) {
                            ach.progress = state.achievements[index].progress || 0;
                            ach.unlocked = state.achievements[index].unlocked || false;
                            
                            // æ›´æ–°UI
                            const achievementEl = document.getElementById(`achievement-${ach.id}`);
                            if (achievementEl) {
                                achievementEl.querySelector('.achievement-progress').textContent = 
                                    `${ach.progress}/${ach.target}`;
                                
                                if (ach.unlocked) {
                                    achievementEl.classList.add('unlocked');
                                }
                            }
                        }
                    });
                }
                
                updateScoreDisplay();
            }
        }

        // å·¥å…·å‡½æ•°ï¼šæ‰“ä¹±æ•°ç»„é¡ºåº
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
